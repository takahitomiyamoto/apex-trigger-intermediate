<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Lv. 3 の解答 · Apex Trigger Intermediate</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="generator" content="HonKit 4.0.4" />
    <meta name="author" content="Takahito Miyamoto" />

    <link rel="stylesheet" href="../gitbook/style.css" />

    <link
      rel="stylesheet"
      href="../gitbook/@honkit/honkit-plugin-highlight/website.css"
    />

    <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css" />

    <link
      rel="stylesheet"
      href="../gitbook/gitbook-plugin-fontsettings/website.css"
    />

    <meta name="HandheldFriendly" content="true" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="152x152"
      href="../gitbook/images/apple-touch-icon-precomposed-152.png"
    />
    <link
      rel="shortcut icon"
      href="../gitbook/images/favicon.ico"
      type="image/x-icon"
    />

    <link rel="next" href="level-04.html" />

    <link rel="prev" href="level-03.html" />
  </head>
  <body>
    <div class="book honkit-cloak">
      <div class="book-summary">
        <div id="book-search-input" role="search">
          <input type="text" placeholder="検索ワードを入力" />
        </div>

        <nav role="navigation">
          <ul class="summary">
            <li class="header">はじめに</li>

            <li class="chapter" data-level="1.1" data-path="../">
              <a href="../"> TOP </a>
            </li>

            <li
              class="chapter"
              data-level="1.2"
              data-path="../intro/common-values.html"
            >
              <a href="../intro/common-values.html"> Common Values </a>
            </li>

            <li
              class="chapter"
              data-level="1.3"
              data-path="../intro/curriculum.html"
            >
              <a href="../intro/curriculum.html"> Curriculum </a>
            </li>

            <li class="header">事前準備</li>

            <li
              class="chapter"
              data-level="2.1"
              data-path="../prerequisite/beginner.html"
            >
              <a href="../prerequisite/beginner.html"> 初級者向けコンテンツ </a>
            </li>

            <li
              class="chapter"
              data-level="2.2"
              data-path="../prerequisite/dev-tools.html"
            >
              <a href="../prerequisite/dev-tools.html"> 開発ツール </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="2.2.1"
                  data-path="../prerequisite/developer-edition.html"
                >
                  <a href="../prerequisite/developer-edition.html">
                    Developer Edition
                  </a>
                </li>

                <li
                  class="chapter"
                  data-level="2.2.2"
                  data-path="../prerequisite/dev-hub.html"
                >
                  <a href="../prerequisite/dev-hub.html"> Dev Hub </a>
                </li>

                <li
                  class="chapter"
                  data-level="2.2.3"
                  data-path="../prerequisite/salesforce-ide.html"
                >
                  <a href="../prerequisite/salesforce-ide.html">
                    Salesforce IDE
                  </a>
                </li>

                <li
                  class="chapter"
                  data-level="2.2.4"
                  data-path="../prerequisite/vs-code-extensions.html"
                >
                  <a href="../prerequisite/vs-code-extensions.html">
                    VS Code Extensions
                  </a>
                </li>

                <li
                  class="chapter"
                  data-level="2.2.5"
                  data-path="../prerequisite/java.html"
                >
                  <a href="../prerequisite/java.html"> Java </a>
                </li>

                <li
                  class="chapter"
                  data-level="2.2.6"
                  data-path="../prerequisite/nodejs.html"
                >
                  <a href="../prerequisite/nodejs.html"> Node.js & Yarn </a>
                </li>
              </ul>
            </li>

            <li class="header">演習問題</li>

            <li class="chapter" data-level="3.1" data-path="warm-up.html">
              <a href="warm-up.html"> Warm-up </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="3.1.1"
                  data-path="warm-up-answer.html"
                >
                  <a href="warm-up-answer.html"> Warm-up の解答 </a>
                </li>
              </ul>
            </li>

            <li class="chapter" data-level="3.2" data-path="level-01.html">
              <a href="level-01.html"> Lv. 1 </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="3.2.1"
                  data-path="level-01-answer.html"
                >
                  <a href="level-01-answer.html"> Lv. 1 の解答 </a>
                </li>
              </ul>
            </li>

            <li class="chapter" data-level="3.3" data-path="level-02.html">
              <a href="level-02.html"> Lv. 2 </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="3.3.1"
                  data-path="level-02-answer.html"
                >
                  <a href="level-02-answer.html"> Lv. 2 の解答 </a>
                </li>
              </ul>
            </li>

            <li class="chapter" data-level="3.4" data-path="level-03.html">
              <a href="level-03.html"> Lv. 3 </a>

              <ul class="articles">
                <li
                  class="chapter active"
                  data-level="3.4.1"
                  data-path="level-03-answer.html"
                >
                  <a href="level-03-answer.html"> Lv. 3 の解答 </a>
                </li>
              </ul>
            </li>

            <li class="chapter" data-level="3.5" data-path="level-04.html">
              <a href="level-04.html"> Lv. 4 </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="3.5.1"
                  data-path="level-04-answer.html"
                >
                  <a href="level-04-answer.html"> Lv. 4 の解答 </a>
                </li>
              </ul>
            </li>

            <li class="chapter" data-level="3.6" data-path="level-05.html">
              <a href="level-05.html"> Lv. 5 </a>

              <ul class="articles">
                <li
                  class="chapter"
                  data-level="3.6.1"
                  data-path="level-05-answer.html"
                >
                  <a href="level-05-answer.html"> Lv. 5 の解答 </a>
                </li>
              </ul>
            </li>

            <li class="header">次のステップ</li>

            <li class="chapter" data-level="4.1" data-path="../next-step/">
              <a href="../next-step/"> Trailhead </a>
            </li>

            <li class="chapter" data-level="4.2" data-path="../next-step/">
              <a href="../next-step/#開発者ガイド"> 開発者ガイド </a>
            </li>

            <li class="divider"></li>

            <li class="chapter" data-level="5.1" data-path="../">
              <a href="../#acknowledgment"> Acknowledgment </a>
            </li>

            <li class="chapter" data-level="5.2" data-path="../">
              <a href="../#author"> Author </a>
            </li>

            <li class="divider"></li>

            <li class="chapter" data-level="6.1">
              <a
                target="_blank"
                href="https://github.com/takahitomiyamoto/apex-trigger-intermediate"
              >
                View on GitHub
              </a>
            </li>

            <li class="divider"></li>

            <li>
              <a
                href="https://github.com/honkit/honkit"
                target="blank"
                class="gitbook-link"
              >
                HonKitで公開
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="book-body">
        <div class="body-inner">
          <div class="book-header" role="navigation">
            <!-- Title -->
            <h1>
              <i class="fa fa-circle-o-notch fa-spin"></i>
              <a href="..">Lv. 3 の解答</a>
            </h1>
          </div>

          <div class="page-wrapper" tabindex="-1" role="main">
            <div class="page-inner">
              <div id="book-search-results">
                <div class="search-noresults">
                  <section class="normal markdown-section">
                    <h1 id="lv-3-の解答">Lv. 3 の解答</h1>
                    <hr />
                    <h2 id="アウトライン">アウトライン</h2>
                    <ul>
                      <li>
                        <a href="#lv-3-の解答">Lv. 3 の解答</a>
                        <ul>
                          <li><a href="#アウトライン">アウトライン</a></li>
                          <li>
                            <a href="#1-apex-テストクラスを作成"
                              >1. Apex テストクラスを作成</a
                            >
                            <ul>
                              <li>
                                <a href="#accounttriggerservicetestcls"
                                  >AccountTriggerServiceTest.cls</a
                                >
                              </li>
                            </ul>
                          </li>
                          <li>
                            <a href="#2-apex-テストクラスを作成"
                              >2. Apex テストクラスを作成</a
                            >
                            <ul>
                              <li>
                                <a href="#accounttestutilscls"
                                  >AccountTestUtils.cls</a
                                >
                              </li>
                              <li>
                                <a href="#accounttriggertestcls"
                                  >AccountTriggerTest.cls</a
                                >
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                    <hr />
                    <h2 id="1-apex-テストクラスを作成">
                      1. Apex テストクラスを作成
                    </h2>
                    <p>
                      1-1. Apex
                      テストを実行して現在のコードカバー率を確認します。
                    </p>
                    <pre><code class="lang-sh"><span class="hljs-variable">$Env</span>:SFDX_IMPROVED_CODE_COVERAGE = <span class="hljs-string">&quot;true&quot;</span>

sfdx force:apex:<span class="hljs-built_in">test</span>:run -c -l RunLocalTests -r human -u demo
</code></pre>
                    <p>
                      なお、環境変数
                      <code>SFDX_IMPROVED_CODE_COVERAGE</code> に対して
                      <code>true</code>
                      が設定されているかどうかを確認したい場合は、次のコマンドを実行してみてください。
                    </p>
                    <pre><code class="lang-sh"><span class="hljs-variable">$Env</span>:SFDX_IMPROVED_CODE_COVERAGE
</code></pre>
                    <pre><code class="lang-sh">=== Test Summary
NAME                 VALUE
───────────────────  ─────────────────────────────────────────────────────────
Outcome              Passed
Tests Ran            44
Passing              44
Failing              0
Skipped              0
Pass Rate            100%
Fail Rate            0%
Test Run Coverage    96%
Org Wide Coverage    90%

(...以下省略...)
</code></pre>
                    <h3 id="accounttriggerservicetestcls">
                      AccountTriggerServiceTest.cls
                    </h3>
                    <p>
                      1-2.
                      <code>AccountTriggerService.cls</code>
                      のテストクラスを作成します。
                    </p>
                    <pre><code class="lang-sh">sfdx force:apex:class:create -d force-app/<span class="hljs-built_in">test</span>/default/classes -n AccountTriggerServiceTest -t ApexUnitTest
</code></pre>
                    <p><strong>AccountTriggerServiceTest.cls</strong></p>
                    <pre><code class="lang-java"><span class="hljs-meta">@isTest(SeeAllData=false)</span>
<span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountTriggerServiceTest</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AccountTriggerService service = <span class="hljs-keyword">new</span> AccountTriggerService();
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FAT_CommonTriggerHandler handler = FAT_CommonTriggerHandler.create(
    Account.class
  );

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addPrefixToName</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    Account account = <span class="hljs-keyword">new</span> Account();
    account.Name = <span class="hljs-string">&apos;Demo&apos;</span>;
    accounts.add(account);

    Test.startTest();
    service.addPrefixToName(accounts);
    Test.stopTest();

    System.assertEquals(<span class="hljs-string">&apos;[サンプル] Demo&apos;</span>, accounts[<span class="hljs-number">0</span>].Name, <span class="hljs-string">&apos;addPrefixToName&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCustomerPriorityHigh</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    Account account = <span class="hljs-keyword">new</span> Account();
    account.Rating = <span class="hljs-string">&apos;Hot&apos;</span>;
    accounts.add(account);

    Test.startTest();
    service.setCustomerPriority(accounts);
    Test.stopTest();

    System.assertEquals(
      <span class="hljs-string">&apos;High&apos;</span>,
      accounts[<span class="hljs-number">0</span>].CustomerPriority__c,
      <span class="hljs-string">&apos;setCustomerPriorityHigh&apos;</span>
    );
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCustomerPriorityMedium</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    Account account = <span class="hljs-keyword">new</span> Account();
    account.Rating = <span class="hljs-string">&apos;Warm&apos;</span>;
    accounts.add(account);

    Test.startTest();
    service.setCustomerPriority(accounts);
    Test.stopTest();

    System.assertEquals(
      <span class="hljs-string">&apos;Medium&apos;</span>,
      accounts[<span class="hljs-number">0</span>].CustomerPriority__c,
      <span class="hljs-string">&apos;setCustomerPriorityMedium&apos;</span>
    );
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCustomerPriorityLow</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    Account account = <span class="hljs-keyword">new</span> Account();
    account.Rating = <span class="hljs-string">&apos;Cold&apos;</span>;
    accounts.add(account);

    Test.startTest();
    service.setCustomerPriority(accounts);
    Test.stopTest();

    System.assertEquals(
      <span class="hljs-string">&apos;Low&apos;</span>,
      accounts[<span class="hljs-number">0</span>].CustomerPriority__c,
      <span class="hljs-string">&apos;setCustomerPriorityLow&apos;</span>
    );
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBeforeInsert</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    handler.newObjects = accounts;

    Test.startTest();
    service.onBeforeInsert(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onBeforeInsert&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBeforeUpdate</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();
    handler.newObjects = accounts;

    Test.startTest();
    service.onBeforeUpdate(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onBeforeInsert&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBeforeDelete</span><span class="hljs-params">()</span> </span>{
    Test.startTest();
    service.onBeforeDelete(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onBeforeDelete&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAfterInsert</span><span class="hljs-params">()</span> </span>{
    Test.startTest();
    service.onAfterInsert(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onAfterInsert&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAfterUpdate</span><span class="hljs-params">()</span> </span>{
    Test.startTest();
    service.onAfterUpdate(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onAfterUpdate&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAfterDelete</span><span class="hljs-params">()</span> </span>{
    Test.startTest();
    service.onAfterDelete(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onAfterDelete&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAfterUndelete</span><span class="hljs-params">()</span> </span>{
    Test.startTest();
    service.onAfterUndelete(handler);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-keyword">null</span>, handler, <span class="hljs-string">&apos;onAfterUndelete&apos;</span>);
  }
}
</code></pre>
                    <p>1-3. コードをフォーマットします。</p>
                    <pre><code class="lang-sh">yarn prettier
</code></pre>
                    <p>1-4. スクラッチ組織へプッシュします。</p>
                    <pre><code class="lang-sh">sfdx force:<span class="hljs-built_in">source</span>:push -u demo
</code></pre>
                    <p>
                      1-5. Apex
                      テストを実行して現在のコードカバー率を確認します。
                    </p>
                    <pre><code class="lang-sh"><span class="hljs-variable">$Env</span>:SFDX_IMPROVED_CODE_COVERAGE = <span class="hljs-string">&quot;true&quot;</span>

sfdx force:apex:<span class="hljs-built_in">test</span>:run -c -l RunLocalTests -r human -u demo
</code></pre>
                    <pre><code class="lang-sh">=== Test Summary
NAME                 VALUE
───────────────────  ─────────────────────────────────────────────────────────
Outcome              Passed
Tests Ran            55
Passing              55
Failing              0
Skipped              0
Pass Rate            100%
Fail Rate            0%
Test Run Coverage    97%
Org Wide Coverage    96%

(...以下省略...)
</code></pre>
                    <hr />
                    <h2 id="2-apex-テストクラスを作成">
                      2. Apex テストクラスを作成
                    </h2>
                    <p>
                      2-1. AccountTrigger.trigger
                      のコードカバー率を向上させるために起動条件を追加します。
                      安心してください、カスタムメタデータ型で制御しているため実際の動作には影響ありません。
                    </p>
                    <pre><code class="lang-java"><span class="hljs-function">trigger AccountTrigger on <span class="hljs-title">Account</span><span class="hljs-params">(
  before insert,
  before update,
  before delete,
  after insert,
  after update,
  after delete,
  after undelete
)</span> </span>{
  FAT_CommonTriggerHandler handler = FAT_CommonTriggerHandler.create(
    Account.class
  );
  handler.invoke();
}
</code></pre>
                    <h3 id="accounttestutilscls">AccountTestUtils.cls</h3>
                    <p>
                      2-2.
                      <code>AccountTrigger.trigger</code>
                      のテストクラスを作成します。
                    </p>
                    <pre><code class="lang-sh">sfdx force:apex:class:create -d force-app/<span class="hljs-built_in">test</span>/default/classes -n AccountTestUtils -t ApexUnitTest
</code></pre>
                    <p><strong>AccountTestUtils.cls</strong></p>
                    <pre><code class="lang-java"><span class="hljs-meta">@SuppressWarnings(&apos;PMD.ApexDoc&apos;)</span>
<span class="hljs-meta">@isTest(SeeAllData=false)</span>
<span class="hljs-keyword">public</span> with sharing <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountTestUtils</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Account&gt; <span class="hljs-title">createNormalAccounts</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = <span class="hljs-keyword">new</span> List&lt;Account&gt;();

    Account account1 = <span class="hljs-keyword">new</span> Account();
    account1.Name = <span class="hljs-string">&apos;Demo1&apos;</span>;
    account1.Rating = <span class="hljs-string">&apos;Hot&apos;</span>;
    accounts.add(account1);

    <span class="hljs-keyword">return</span> accounts;
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Account&gt; <span class="hljs-title">selectAccounts</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> [
      SELECT Id, Name, Rating, CustomerPriority__c
      FROM Account
      ORDER BY Name ASC
      LIMIT <span class="hljs-number">50000</span>
    ];
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertAccounts</span><span class="hljs-params">(List&lt;Account&gt; accounts)</span> </span>{
    List&lt;Database.SaveResult&gt; results = Database.insert(accounts, <span class="hljs-keyword">false</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateAccounts</span><span class="hljs-params">(List&lt;Account&gt; accounts)</span> </span>{
    List&lt;Database.SaveResult&gt; results = Database.update(accounts, <span class="hljs-keyword">false</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteAccounts</span><span class="hljs-params">(List&lt;Account&gt; accounts)</span> </span>{
    List&lt;Database.DeleteResult&gt; results = Database.delete(accounts, <span class="hljs-keyword">false</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">undeleteAccounts</span><span class="hljs-params">(List&lt;Account&gt; accounts)</span> </span>{
    List&lt;Database.UndeleteResult&gt; results = Database.undelete(accounts, <span class="hljs-keyword">false</span>);
  }
}
</code></pre>
                    <h3 id="accounttriggertestcls">AccountTriggerTest.cls</h3>
                    <pre><code class="lang-sh">sfdx force:apex:class:create -d force-app/<span class="hljs-built_in">test</span>/default/classes -n AccountTriggerTest -t ApexUnitTest
</code></pre>
                    <p><strong>AccountTriggerTest.cls</strong></p>
                    <pre><code class="lang-java"><span class="hljs-meta">@isTest(SeeAllData=false)</span>
<span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountTriggerTest</span> </span>{
  <span class="hljs-meta">@testSetup</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = AccountTestUtils.createNormalAccounts();
    AccountTestUtils.insertAccounts(accounts);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeUpdate</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = AccountTestUtils.selectAccounts();

    Test.startTest();
    AccountTestUtils.updateAccounts(accounts);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-number">0</span>, accounts.size(), <span class="hljs-string">&apos;invokeUpdate&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeDelete</span><span class="hljs-params">()</span> </span>{
    List&lt;Account&gt; accounts = AccountTestUtils.selectAccounts();
    AccountTestUtils.deleteAccounts(accounts);

    Test.startTest();
    AccountTestUtils.undeleteAccounts(accounts);
    Test.stopTest();

    System.assertNotEquals(<span class="hljs-number">0</span>, accounts.size(), <span class="hljs-string">&apos;invokeDelete&apos;</span>);
  }

  <span class="hljs-meta">@isTest</span>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeException</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// TODO</span>
  }
}
</code></pre>
                    <p>2-3. コードをフォーマットします。</p>
                    <pre><code class="lang-sh">yarn prettier
</code></pre>
                    <p>2-4. スクラッチ組織へプッシュします。</p>
                    <pre><code class="lang-sh">sfdx force:<span class="hljs-built_in">source</span>:push -u demo
</code></pre>
                    <p>
                      2-5. Apex
                      テストを実行して現在のコードカバー率を確認します。
                    </p>
                    <pre><code class="lang-sh"><span class="hljs-variable">$Env</span>:SFDX_IMPROVED_CODE_COVERAGE = <span class="hljs-string">&quot;true&quot;</span>

sfdx force:apex:<span class="hljs-built_in">test</span>:run -c -l RunLocalTests -r human -u demo
</code></pre>
                    <pre><code class="lang-sh">=== Test Summary
NAME                 VALUE
───────────────────  ─────────────────────────────────────────────────────────
Outcome              Passed
Tests Ran            58
Passing              58
Failing              0
Skipped              0
Pass Rate            100%
Fail Rate            0%
Test Run Coverage    99%
Org Wide Coverage    99%

(...以下省略...)
</code></pre>
                    <p>
                      コードカバー率 100%まであと 1%です。後ほど対応しましょう。
                    </p>
                    <p>
                      ...いかがでしょう、だいぶテストクラスが書きやすくなっていませんか？
                      もしもトリガからビジネスロジックを分離していなかったら、ビジネスロジックをテストするためにわざわざ
                      insert などして無理やり Apex
                      トリガを起動させないといけませんでした。
                    </p>
                    <p>
                      今回はビジネスロジックに集中してテストコードを書けば良くなっているので、ちゃんと細かく単体テストしてる気持ちになれるのではないでしょうか。
                      将来ビジネスロジックが複雑になったとしても、ホワイトボックステストを書きやすいですよね。
                    </p>
                  </section>
                </div>
                <div class="search-results">
                  <div class="has-results">
                    <h1 class="search-results-title">
                      <span class="search-results-count"></span> results
                      matching "<span class="search-query"></span>"
                    </h1>
                    <ul class="search-results-list"></ul>
                  </div>
                  <div class="no-results">
                    <h1 class="search-results-title">
                      No results matching "<span class="search-query"></span>"
                    </h1>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <a
          href="level-03.html"
          class="navigation navigation-prev"
          aria-label="Previous page: Lv. 3"
        >
          <i class="fa fa-angle-left"></i>
        </a>

        <a
          href="level-04.html"
          class="navigation navigation-next"
          aria-label="Next page: Lv. 4"
        >
          <i class="fa fa-angle-right"></i>
        </a>
      </div>

      <script>
        var gitbook = gitbook || [];
        gitbook.push(function () {
          gitbook.page.hasChanged({
            page: {
              title: 'Lv. 3 の解答',
              level: '3.4.1',
              depth: 2,
              next: {
                title: 'Lv. 4',
                level: '3.5',
                depth: 1,
                path: 'exercises/level-04.md',
                ref: 'exercises/level-04.md',
                articles: [
                  {
                    title: 'Lv. 4 の解答',
                    level: '3.5.1',
                    depth: 2,
                    path: 'exercises/level-04-answer.md',
                    ref: 'exercises/level-04-answer.md',
                    articles: []
                  }
                ]
              },
              previous: {
                title: 'Lv. 3',
                level: '3.4',
                depth: 1,
                path: 'exercises/level-03.md',
                ref: 'exercises/level-03.md',
                articles: [
                  {
                    title: 'Lv. 3 の解答',
                    level: '3.4.1',
                    depth: 2,
                    path: 'exercises/level-03-answer.md',
                    ref: 'exercises/level-03-answer.md',
                    articles: []
                  }
                ]
              },
              dir: 'ltr'
            },
            config: {
              plugins: [],
              root: './docs',
              styles: {
                website: 'styles/website.css',
                pdf: 'styles/pdf.css',
                epub: 'styles/epub.css',
                mobi: 'styles/mobi.css',
                ebook: 'styles/ebook.css',
                print: 'styles/print.css'
              },
              pluginsConfig: {
                highlight: {},
                search: {},
                lunr: { maxIndexSize: 1000000, ignoreSpecialCharacters: false },
                fontsettings: { theme: 'white', family: 'sans', size: 2 },
                'theme-default': {
                  styles: {
                    website: 'styles/website.css',
                    pdf: 'styles/pdf.css',
                    epub: 'styles/epub.css',
                    mobi: 'styles/mobi.css',
                    ebook: 'styles/ebook.css',
                    print: 'styles/print.css'
                  },
                  showLevel: false
                }
              },
              'pdf.embedFonts': 'false',
              theme: 'default',
              'structure.readme': 'docs/README.md',
              'pdf.margin.left': '62',
              author: 'Takahito Miyamoto',
              'structure.summary': 'docs/SUMMARY.md',
              'pdf.fontSize': '12',
              'pdf.margin.bottom': '56',
              'pdf.fontFamily': 'Arial',
              'pdf.paperSize': 'a4',
              'pdf.margin.top': '56',
              pdf: {
                pageNumbers: true,
                fontSize: 12,
                fontFamily: 'Arial',
                paperSize: 'a4',
                chapterMark: 'pagebreak',
                pageBreaksBefore: '/',
                margin: { right: 62, left: 62, top: 56, bottom: 56 },
                embedFonts: false
              },
              structure: {
                langs: 'LANGS.md',
                readme: 'README.md',
                glossary: 'GLOSSARY.md',
                summary: 'SUMMARY.md'
              },
              variables: {},
              'pdf.margin.right': '62',
              title: 'Apex Trigger Intermediate',
              language: 'ja',
              gitbook: '*',
              description: 'Apex トリガの中級レベルのチュートリアルです。',
              'pdf.pageNumbers': 'true'
            },
            file: {
              path: 'exercises/level-03-answer.md',
              mtime: '2023-01-26T10:23:14.640Z',
              type: 'markdown'
            },
            gitbook: { version: '4.0.4', time: '2023-01-26T10:24:10.017Z' },
            basePath: '..',
            book: { language: '' }
          });
        });
      </script>
    </div>

    <noscript>
      <style>
        .honkit-cloak {
          display: block !important;
        }
      </style>
    </noscript>
    <script>
      // Restore sidebar state as critical path for prevent layout shift
      function __init__getSidebarState(defaultValue) {
        var baseKey = '';
        var key = baseKey + ':sidebar';
        try {
          var value = localStorage[key];
          if (value === undefined) {
            return defaultValue;
          }
          var parsed = JSON.parse(value);
          return parsed == null ? defaultValue : parsed;
        } catch (e) {
          return defaultValue;
        }
      }
      function __init__restoreLastSidebarState() {
        var isMobile = window.matchMedia('(max-width: 600px)').matches;
        if (isMobile) {
          // Init last state if not mobile
          return;
        }
        var sidebarState = __init__getSidebarState(true);
        var book = document.querySelector('.book');
        // Show sidebar if it enabled
        if (sidebarState && book) {
          book.classList.add('without-animation', 'with-summary');
        }
      }

      try {
        __init__restoreLastSidebarState();
      } finally {
        var book = document.querySelector('.book');
        book.classList.remove('honkit-cloak');
      }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>

    <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>

    <script src="../gitbook/gitbook-plugin-search/search.js"></script>

    <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>

    <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>

    <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
  </body>
</html>
